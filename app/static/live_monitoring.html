<!DOCTYPE html>
<html>
<head>
    <title>Live Poker Monitoring - Real-time Turn Detection</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Consolas', 'Monaco', monospace; 
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #e0e0e0; 
            height: 100vh; 
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #64ffda;
        }
        
        .header h1 {
            color: #64ffda;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #888;
            font-size: 16px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(100, 100, 150, 0.3);
        }
        
        .control-panel h3 {
            color: #64ffda;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn.success { background: linear-gradient(45deg, #11998e 0%, #38ef7d 100%); }
        .btn.danger { background: linear-gradient(45deg, #ff416c 0%, #ff4b2b 100%); }
        .btn.warning { background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-panel {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(100, 100, 150, 0.3);
        }
        
        .status-panel h3 {
            color: #64ffda;
            margin-bottom: 15px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            color: #ccc;
        }
        
        .status-value {
            color: #64ffda;
            font-weight: bold;
        }
        
        .status-value.success { color: #38ef7d; }
        .status-value.danger { color: #ff4b2b; }
        .status-value.warning { color: #f5576c; }
        
        .live-feed {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(100, 100, 150, 0.3);
            height: 300px;
            overflow-y: auto;
        }
        
        .live-feed h3 {
            color: #64ffda;
            margin-bottom: 15px;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 14px;
        }
        
        .log-timestamp {
            color: #888;
            font-size: 12px;
        }
        
        .log-message {
            margin-left: 10px;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(100, 100, 150, 0.3);
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #64ffda;
        }
        
        .metric-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .alert.success {
            background: rgba(56, 239, 125, 0.1);
            border: 1px solid #38ef7d;
            color: #38ef7d;
        }
        
        .alert.error {
            background: rgba(255, 75, 43, 0.1);
            border: 1px solid #ff4b2b;
            color: #ff4b2b;
        }
        
        .alert.warning {
            background: rgba(245, 87, 108, 0.1);
            border: 1px solid #f5576c;
            color: #f5576c;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŽ¯ Live Poker Monitoring</h1>
        <div class="subtitle">Real-time Turn Detection & Automated Advisory with 60+ FPS Capture</div>
    </div>

    <!-- Performance Metrics -->
    <div class="performance-metrics">
        <div class="metric-card">
            <div class="metric-value" id="fps-display">0</div>
            <div class="metric-label">Capture FPS</div>
        </div>
        <div class="metric-card">
            <div class="metric-value" id="response-time">0ms</div>
            <div class="metric-label">Response Time</div>
        </div>
        <div class="metric-card">
            <div class="metric-value" id="turn-count">0</div>
            <div class="metric-label">Turns Detected</div>
        </div>
        <div class="metric-card">
            <div class="metric-value" id="accuracy">0%</div>
            <div class="metric-label">Button Accuracy</div>
        </div>
    </div>

    <!-- Control Panels -->
    <div class="controls">
        <div class="control-panel">
            <h3>Monitoring Control</h3>
            <button class="btn success" id="start-monitoring">Start Live Monitoring</button>
            <button class="btn danger" id="stop-monitoring">Stop Monitoring</button>
            <button class="btn" id="test-performance">Test Performance</button>
            <button class="btn warning" id="save-debug">Save Debug Frame</button>
        </div>

        <div class="control-panel">
            <h3>Auto Decisions</h3>
            <button class="btn success" id="enable-auto">Enable Auto Decisions</button>
            <button class="btn danger" id="disable-auto">Disable Auto Decisions</button>
            <button class="btn" id="capture-table">Capture Full Table</button>
            <button class="btn" id="test-buttons">Test Button Detection</button>
        </div>
    </div>

    <!-- Status Display -->
    <div class="status-grid">
        <div class="status-panel">
            <h3>System Status</h3>
            <div class="status-item">
                <span class="status-label">Monitoring Active:</span>
                <span class="status-value" id="monitoring-status">Not Started</span>
            </div>
            <div class="status-item">
                <span class="status-label">Auto Decisions:</span>
                <span class="status-value" id="auto-decisions-status">Disabled</span>
            </div>
            <div class="status-item">
                <span class="status-label">Current FPS:</span>
                <span class="status-value" id="current-fps">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Regions Detected:</span>
                <span class="status-value" id="regions-count">0</span>
            </div>
        </div>

        <div class="status-panel">
            <h3>Turn Detection</h3>
            <div class="status-item">
                <span class="status-label">My Turn:</span>
                <span class="status-value" id="my-turn-status">Unknown</span>
            </div>
            <div class="status-item">
                <span class="status-label">Active Buttons:</span>
                <span class="status-value" id="active-buttons">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Confidence:</span>
                <span class="status-value" id="confidence">0%</span>
            </div>
            <div class="status-item">
                <span class="status-label">Recommendation:</span>
                <span class="status-value" id="recommendation">None</span>
            </div>
        </div>
    </div>

    <!-- Live Feed -->
    <div class="live-feed">
        <h3>Live Activity Feed</h3>
        <div id="activity-log"></div>
    </div>

    <script>
        // State tracking
        let isMonitoring = false;
        let autoDecisions = false;
        let updateInterval = null;
        let turnCount = 0;

        // DOM elements
        const elements = {
            startBtn: document.getElementById('start-monitoring'),
            stopBtn: document.getElementById('stop-monitoring'),
            testPerformanceBtn: document.getElementById('test-performance'),
            saveDebugBtn: document.getElementById('save-debug'),
            enableAutoBtn: document.getElementById('enable-auto'),
            disableAutoBtn: document.getElementById('disable-auto'),
            captureTableBtn: document.getElementById('capture-table'),
            testButtonsBtn: document.getElementById('test-buttons'),
            
            // Status displays
            monitoringStatus: document.getElementById('monitoring-status'),
            autoDecisionsStatus: document.getElementById('auto-decisions-status'),
            currentFps: document.getElementById('current-fps'),
            regionsCount: document.getElementById('regions-count'),
            myTurnStatus: document.getElementById('my-turn-status'),
            activeButtons: document.getElementById('active-buttons'),
            confidence: document.getElementById('confidence'),
            recommendation: document.getElementById('recommendation'),
            
            // Metrics
            fpsDisplay: document.getElementById('fps-display'),
            responseTime: document.getElementById('response-time'),
            turnCountDisplay: document.getElementById('turn-count'),
            accuracy: document.getElementById('accuracy'),
            
            activityLog: document.getElementById('activity-log')
        };

        // API helper
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };
                
                if (data && method !== 'GET') {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`/live/${endpoint}`, options);
                return await response.json();
            } catch (error) {
                logActivity(`API Error: ${error.message}`, 'error');
                return null;
            }
        }

        // Event listeners
        elements.startBtn.addEventListener('click', async () => {
            const result = await apiCall('start-monitoring', 'POST');
            if (result && result.status === 'started') {
                isMonitoring = true;
                startStatusUpdates();
                logActivity('Live monitoring started successfully', 'success');
                updateUI();
            }
        });

        elements.stopBtn.addEventListener('click', async () => {
            const result = await apiCall('stop-monitoring', 'POST');
            if (result && result.status === 'stopped') {
                isMonitoring = false;
                stopStatusUpdates();
                logActivity('Live monitoring stopped', 'warning');
                updateUI();
            }
        });

        elements.testPerformanceBtn.addEventListener('click', async () => {
            logActivity('Running performance test...', 'info');
            const result = await apiCall('test-capture-performance');
            if (result && result.status === 'success') {
                logActivity('Performance test completed - check server logs', 'success');
            }
        });

        elements.saveDebugBtn.addEventListener('click', async () => {
            const result = await apiCall('save-debug-frame', 'POST');
            if (result && result.status === 'success') {
                logActivity(result.message, 'success');
            }
        });

        elements.enableAutoBtn.addEventListener('click', async () => {
            const result = await apiCall('enable-auto-decisions', 'POST');
            if (result && result.status === 'success') {
                autoDecisions = true;
                logActivity('Auto decisions enabled', 'success');
                updateUI();
            }
        });

        elements.disableAutoBtn.addEventListener('click', async () => {
            const result = await apiCall('enable-auto-decisions?enable=false', 'POST');
            if (result && result.status === 'success') {
                autoDecisions = false;
                logActivity('Auto decisions disabled', 'warning');
                updateUI();
            }
        });

        elements.captureTableBtn.addEventListener('click', async () => {
            logActivity('Capturing full table state...', 'info');
            const result = await apiCall('capture-table');
            if (result && result.status === 'success') {
                logActivity('Table state captured successfully', 'success');
            }
        });

        elements.testButtonsBtn.addEventListener('click', async () => {
            logActivity('Testing button detection...', 'info');
            const result = await apiCall('test-button-detection');
            if (result && result.status === 'success') {
                logActivity('Button detection test completed', 'success');
            }
        });

        // Status updates
        function startStatusUpdates() {
            if (updateInterval) clearInterval(updateInterval);
            updateInterval = setInterval(updateStatus, 500); // 2 FPS updates
        }

        function stopStatusUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
            }
        }

        async function updateStatus() {
            const status = await apiCall('status');
            if (!status) return;

            // Update system status
            elements.monitoringStatus.textContent = status.monitoring_active ? 'Active' : 'Stopped';
            elements.monitoringStatus.className = `status-value ${status.monitoring_active ? 'success' : 'danger'}`;
            
            elements.autoDecisionsStatus.textContent = status.auto_decisions ? 'Enabled' : 'Disabled';
            elements.autoDecisionsStatus.className = `status-value ${status.auto_decisions ? 'success' : 'danger'}`;

            // Update turn detection
            if (status.current_state) {
                const state = status.current_state;
                
                elements.currentFps.textContent = state.fps || 0;
                elements.fpsDisplay.textContent = state.fps || 0;
                
                elements.myTurnStatus.textContent = state.is_my_turn ? 'YES' : 'No';
                elements.myTurnStatus.className = `status-value ${state.is_my_turn ? 'success' : ''}`;
                
                elements.activeButtons.textContent = state.active_buttons || 0;
                
                const confidencePercent = Math.round((state.confidence || 0) * 100);
                elements.confidence.textContent = `${confidencePercent}%`;
                elements.accuracy.textContent = `${confidencePercent}%`;
                
                elements.recommendation.textContent = state.decision_recommendation || 'None';
                
                // Track turns
                if (state.is_my_turn && !window.lastTurnState) {
                    turnCount++;
                    elements.turnCountDisplay.textContent = turnCount;
                    logActivity(`Turn detected! Confidence: ${confidencePercent}%`, 'success');
                }
                window.lastTurnState = state.is_my_turn;
            }

            // Update performance metrics
            if (status.performance) {
                const perf = status.performance;
                elements.regionsCount.textContent = perf.regions_detected || 0;
                
                // Calculate response time (simplified)
                const avgFps = perf.average_fps || 0;
                const responseTime = avgFps > 0 ? Math.round(1000 / avgFps) : 0;
                elements.responseTime.textContent = `${responseTime}ms`;
            }
        }

        // UI updates
        function updateUI() {
            elements.startBtn.disabled = isMonitoring;
            elements.stopBtn.disabled = !isMonitoring;
            elements.enableAutoBtn.disabled = autoDecisions;
            elements.disableAutoBtn.disabled = !autoDecisions;
        }

        // Activity logging
        function logActivity(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const logClass = type === 'error' ? 'danger' : type;
            
            logEntry.innerHTML = `
                <span class="log-timestamp">${timestamp}</span>
                <span class="log-message status-value ${logClass}">${message}</span>
            `;
            
            elements.activityLog.insertBefore(logEntry, elements.activityLog.firstChild);
            
            // Keep only last 50 entries
            while (elements.activityLog.children.length > 50) {
                elements.activityLog.removeChild(elements.activityLog.lastChild);
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            logActivity('Live monitoring interface loaded', 'success');
            updateUI();
            
            // Start periodic status updates even when not monitoring
            setInterval(updateStatus, 2000);
        });
    </script>
</body>
</html>