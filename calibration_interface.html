<!DOCTYPE html>
<html>
<head>
    <title>ACR Table Calibration</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #0a0a0a; color: #ffffff; }
        .header { text-align: center; margin-bottom: 30px; }
        .button { background-color: #4CAF50; color: white; border: none; padding: 15px 30px; cursor: pointer; font-size: 16px; margin: 10px; border-radius: 5px; }
        .button:hover { background-color: #45a049; }
        .status { margin: 20px 0; padding: 15px; background-color: #1a1a1a; border-radius: 5px; border: 1px solid #333; }
        .success { background-color: #1a4a1a; border-color: #4CAF50; }
        .error { background-color: #4a1a1a; border-color: #f44336; }
        .loading { background-color: #4a4a1a; border-color: #ff9800; }
        .instructions { background-color: #1a1a2a; padding: 20px; border-radius: 5px; margin: 20px 0; }
        .step { margin: 10px 0; padding: 10px; background-color: #2a2a2a; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🎯 ACR Table Calibration</h1>
        <p>Automatically detect and calibrate your ACR poker table</p>
    </div>

    <div class="instructions">
        <h3>📋 Setup Instructions:</h3>
        <div class="step">1. Open ACR Poker client on your computer</div>
        <div class="step">2. Join any poker table (not lobby)</div>
        <div class="step">3. Make sure table is visible and not minimized</div>
        <div class="step">4. Click "Start Calibration" below</div>
    </div>

    <div style="text-align: center;">
        <button class="button" onclick="startCalibration()">🔍 Start Calibration</button>
        <button class="button" onclick="checkStatus()" style="background-color: #2196F3;">📊 Check Status</button>
    </div>

    <div id="status" class="status" style="display: none;">
        <div id="statusContent"></div>
    </div>

    <script>
        async function startCalibration() {
            showStatus('🔄 Starting calibration...', 'loading');
            
            try {
                const response = await fetch('/calibration/auto-calibrate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`✅ Calibration successful!<br>
                               📊 Accuracy: ${(result.accuracy_score * 100).toFixed(1)}%<br>
                               🎯 Regions found: ${result.regions_found}<br>
                               💡 Table detected: ${result.table_detected ? 'Yes' : 'No'}`, 'success');
                } else {
                    let recommendations = '';
                    if (result.recommendations) {
                        recommendations = '<br><br><strong>Recommendations:</strong><br>' + 
                                        result.recommendations.map(r => `• ${r}`).join('<br>');
                    }
                    showStatus(`❌ ${result.message}${recommendations}`, 'error');
                }
            } catch (error) {
                showStatus(`❌ Calibration failed: ${error.message}`, 'error');
            }
        }

        async function checkStatus() {
            showStatus('🔄 Checking system status...', 'loading');
            
            try {
                const response = await fetch('/health');
                const result = await response.json();
                
                showStatus(`📊 System Status: ${result.status}<br>
                           🤖 GTO Engine: ${result.gto_service ? 'Active' : 'Inactive'}<br>
                           📷 Scraper: ${result.scraper_manager ? 'Ready' : 'Not Ready'}<br>
                           🕐 Uptime: ${result.uptime || 'Unknown'}`, 'success');
            } catch (error) {
                showStatus(`❌ Status check failed: ${error.message}`, 'error');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            const contentDiv = document.getElementById('statusContent');
            
            contentDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }

        // Auto-check status on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkStatus();
        });
    </script>
</body>
</html>